+++
title = "环境管理"
description = "是面向平台管理员、项目创建者和项目所有者根据不同用途配置相对应的环境信息。可以创建环境，删除环境，及对环境详情信息进行编辑修改"
weight = 2
+++

# 环境管理

环境是一个客户端，是部署流水线和k8s信息交互的桥梁，实质上也是一个实例，不过该实例是直接用helm部署在集群中，有了环境，我们就可以部署实例，部署网络，部署域名。

环境可以部署在不同的集群中，由此就会产生不同的环境。比如开发测试环境、预生产环境、生产环境等。使系统的开发，测试，上线变的更加可视化，流程化。

当创建多个环境后环境管理界面会自动生成一条环境流水线，用户可以根据需要调整顺序环境的顺序，通过环境流水线，用户可以清晰地定义和查看应用部署的顺序。

  
  - **菜单层次**：项目层
  
  - **菜单路径**：部署流水线 > 环境管理
  
  - **默认角色**：项目所有者
  
<blockquote class="note">
 只有项目所有者对环境管理有查看和编辑操作的权限。
</blockquote>

<blockquote class="note">
 支持停用未连接的环境或不含运行中实例的环境，但只能对停用区的环境进行删除操作。
</blockquote>

## 环境管理

- 进入`部署流水线`后，点击 `环境管理` 页签；
 
 **1. 前置条件**

 - 使用集群节点地址，用户名，密码连接到所要创建环境的集群机器上，确保集群内安装了helm。  
 - 创建环境前，请确保该项目对应的组织中已存在可用的集群。在组织中创建集群的操作详见[`集群管理`](/zh/docs/user-guide/cluster-management/cluster)。


**2. 创建环境**
  
  ![创建环境](/docs/user-guide/deployment-pipeline/image/envcreate.png)
 
-  点击`创建环境`，系统会滑出创建环境页面，输入或选择相关信息，包括集群、环境编码、环境名称、环境描述；同时，项目所有者需要为该环境分配特定的操作人员，且操作人员只能从本项目下进行选择。  
    选择集群：此处只能选择已对该项目授权的集群进行连接；连接后，环境的状态由所连的集群决定，若集群是运行中，则该环境也是运行中的状态，集群未连接，则环境也是未连接；若想激活环境，只有先将集群激活。
	
	环境编码：集群中产生的环境客户端的名称，限制60个字符。
	     <blockquote class="warning">
       只能由小写字母、数字、"-"组成，且以小写字母开头，不能以"-"结尾
    	</blockquote>

	环境名称：平台环境的显示名称。现在为10个字符。
	
	环境描述：环境的描述，限制为60字符。  
	环境分组：环境的分组，只能从已创建的分组中进行选择，从而将此环境放入该分组中。  
	环境权限分配：为该环境分配特定的操作人员，配置后，只有被勾选的项目成员才能在该环境下进行部署相关的操作。列表中的成员是该项目下所有的项目成员。项目下所有的项目所有者直接默认为该项目下全部环境的管理员，并且可以对环境进行权限分配。

    <blockquote class="note">
        根据用途配置不同的环境，常见的有开发环境，集成测试环境，用户访问测试环境及正式环境。同时，可以为这些环境分别配置特定的操作人员，配置后，只有被勾选的成员才能在对应的环境下进行部署相关的操作。新环境默认新增在环境流水线的最后一个节点。
     </blockquote>

-  填写完成后，点击`创建`，回到环境管理界面；若所连接的集群状态为运行中，则该环境的状态为运行中，如果对应集群未连接，那么该环境也是未连接。若想激活环境，只有先将集群激活。


**3. 查看环境详情**

 1. 进入`部署流水线`后，点击 `环境管理` 页签；

 2. 查看应用环境的运行情况。

![应用环境](/docs/user-guide/deployment-pipeline/image/environment.png)
 

- 在环境卡片中，点击`修改环境`→ ![修改环境按钮](/docs/user-guide/deployment-pipeline/image/update_env_button.png) ，修改环境名称、描述以及所在分组。
- 在环境卡片中，点击`禁用环境`→ ![停用按钮](/docs/user-guide/deployment-pipeline/image/stop_button.png) ，当点击确认后，该环境将被禁用。
- 在环境卡片中，点击`权限分配`→ ![权限分配按钮](/docs/user-guide/deployment-pipeline/image/authority_button.png)，进入权限分配界面，为此环境分配特定的操作人员。
 <blockquote class="warning">
    运行中的环境，若里面存在实例、网络或域名时，环境不可禁用！否则，皆可以直接禁用。
    </blockquote>  

**4. 创建分组**  

![创建分组](/docs/user-guide/deployment-pipeline/image/environment.png)  

-   点击`创建分组`，系统中会弹出创建环境分组的窗口，需要输入分组名称。
	
	分组名称:限制为20个字符。

**5. 环境权限分配**   
![环境权限分配](/docs/user-guide/deployment-pipeline/image/authority_management.jpg)  

- 在环境管理首页选择某个环境，并在该环境卡片上面点击权限分配按钮，进入到权限分配界面。  
-  在权限分配界面，可以在该项目下所有的项目成员中挑选出特定的环境操作人员，并通过勾选的方式，授予该成员在此环境中相关的操作权限。若取消勾选，那么该成员不再有此环境的操作权限。  
-  权限配置成功后，该项目成员便可在该环境中进行应用部署、实例管理、网络管理、域名管理以及证书管理的操作。

## 环境客户端补充说明

环境客户端使用了平台的 [Choerodon-Agent](../../../concept/choerodon-agent/) 技术，通过 websocket 方式连接到猪齿鱼平台。双方通过 `command/response` 方式来进行交互，来完成 `helm release` 的管理、网络管理、 k8s 对象监听和容器日志和 shell 等功能。 

## 环境停用区 

- 可在环境停用区查看已被停用的环境，点击卡片右上角`启用按钮` → ![启用按钮](/docs/user-guide/deployment-pipeline/image/start_button.png) 重新启用，重新启用后默认加至流水线最后一个节点。  
- 可以对停用区的环境进行删除操作。  


 
## 更多操作
- [环境总览](../environments-overview)
- [应用部署](../application-deployment)
- [实例管理](../instance)
- [网络管理](../service)

 
